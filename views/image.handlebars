<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
    integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
    crossorigin="" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
    integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
    crossorigin=""></script>
  <script type="text/javascript">
    function stopDefault(event) {
      event.preventDefault();
      event.stopPropagation();
    }
    function dragOver(label, text) {
      /* ADD ALMOST ANY STYLING YOU LIKE */
      label.style.animationName = "dropbox";
      label.innerText = text;
    }
    function dragLeave(label) {
      /* THIS SHOULD REMOVE ALL STYLING BY dragOver() */
      var len = label.style.length;
      for (var i = 0; i < len; i++) {
        label.style[label.style[i]] = "";
      }
      label.innerText = "Click to choose images or Drop them here";
    }
    function addFilesAndSubmit(event) {
      var files = event.target.files || event.dataTransfer.files;
      document.getElementById("filesfld").files = files;
      submitFilesForm(document.getElementById("filesfrm"));
    }
    function submitFilesForm(form) {
      var label = document.getElementById("fileslbl");
      dragOver(label, "Uploading images..."); // set the drop zone text and styling
      var fd = new FormData();
      for (var i = 0; i < form.filesfld.files.length; i++) {
        var field = form.filesfld;
        fd.append(field.name, field.files[i], field.files[i].name);
      }
      var progress = document.getElementById("progress");
      var x = new XMLHttpRequest();
      if (x.upload) {
        x.upload.addEventListener("progress", function (event) {
          var percentage = parseInt(event.loaded / event.total * 100);
          progress.innerText = progress.style.width = percentage + "%";
        });
      }
      x.onreadystatechange = function () {
        if (x.readyState == 4) {
          progress.innerText = progress.style.width = "";
          form.filesfld.value = "";
          dragLeave(label); // this will reset the text and styling of the drop zone
          if (x.status == 200) {

          }
          else {
            // failed - TODO: Add code to handle server errors
          }
        }
      };
      x.open("post", form.action, true);
      x.send(fd);
      return false;
    }
  </script>
  <style>
    body {
      background-color: #E5F0E6;
    }

    #mymap {
      height: 180px;
    }
  </style>
  <title>Document</title>
</head>

<body>
  <div class="home">
    â€‹
    <h1>Welcome</h1>
  </div>
  <div class="pizzas">
    <div class="container">
      <div class="row">
        <div class="col-4 small">
<h2>Send a Query</h2>
          {{!-- <h2>Status Bar</h2> --}}
          <div class="section">

            

            <form action="/reminder" method="POST">

              <div>
                <label for="">Describe your Query:</label>
                <input type="text" name="firstName" placeholder="Enter your Query here">
              </div>
              {{!-- <div>
                <label for="">Days to query:</label>
                <input type="text" name="bookCount" placeholder="Enter the number of days">
              </div>
              <div>
                <label for="">Days due in:</label>

                <input type="text" name="dayCount" placeholder="Enter the # of days">
              </div> --}}

              <div>
                <input type="submit" class="bigger-button" value="send your Query">
              </div>
            </form>

          </div>

          <div>
            <h2>Queries</h2>


            {{#each notifications}}
            <div class="section mt-1">

               {{first_name}}
              {{!-- <br><br>
               <strong>{{book_count}}</strong> queries(s) you sent took out at the library is due in
              <strong>{{days_due_in}}</strong> day(s).
              <br><br> --}}

              {{!-- {{#if notLate}}
              Please return these books to us in the next <a href="/reminder/{{days_due_in}}/days">{{days_due_in}}
                days</a> .
              {{else}}
              <span class="late"> Please return your books <strong>urgently</strong></span>
              {{/if}} --}}

              {{!-- <div class="mt-1">
                <a href="/edit/{{id}}">Edit query</a>
              </div> --}}
              <div class="return-book mt-1">
                <form method="POST" action="/return/{{id}}">
                  <input type="submit" class="small-button" value="Remove Query">
                </form>
              </div>
            </div>
            {{/each}}
          </div>
        </div>

        
        <div class="col-4 medium">

          <div class="water">
            <h1>Upload Media</h1>
            <form id="filesfrm" action="/user" method="post" onsubmit="return submitFilesForm(this);">
              <input type="file" name="filesfld" id="filesfld" accept="image/*" onchange="submitFilesForm(this.form);"
                multiple />
              <label for="filesfld" id="fileslbl"
                ondragover="stopDefault(event);dragOver(this, 'Drop the images to upload them.');"
                ondragenter="stopDefault(event);dragOver(this, 'Drop the images to upload them.');"
                ondragleave="stopDefault(event);dragLeave(this);"
                ondrop="stopDefault(event);dragLeave(this);addFilesAndSubmit(event);">
                <div id="icon" class="icon"><i class="fas fa-cloud-upload-alt"></i></div>

                Drop file here or click to upload
              </label>
            </form>
            <div style="text-align: left;">
              <div id="progress"></div>
            </div>
          </div>
        </div>
        <div class="col-4 large">
          <h1>Attach Location</h1>
          <p>
            latitude: <span id="latitude"></span>&deg;<br />
            longitude: <span id="longitude"></span>&deg;
          </p>
          <div id="mymap"></div>
        </div>
        <div class="col-12 contact">
          <h2>Social Media</h2>
          <p><a href="https://twitter.com/JHBWater" target="_blank"> twitter</a>
            <br>
            <a href="https://www.facebook.com/RandWater/" target="_blank"> facebook</a>
            <br>
            <a href="https://www.youtube.com/watch?v=N_2Dr28k2ag" target="_blank"> Youtube</a>
          </p>


        </div>
      </div>
    </div>
  </div>




  <script>
    if ('geolocation' in navigator) {
      console.log('geolocation available');
      navigator.geolocation.getCurrentPosition(async position => {
        lat = position.coords.latitude;
        lon = position.coords.longitude;
        console.log(lat, lon);
        document.getElementById('latitude').textContent = lat;
        document.getElementById('longitude').textContent = lon;

        const mymap = L.map('mymap').setView([lat, lon], 15);
        const attribution =
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';
        const tileUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
        const tiles = L.tileLayer(tileUrl, { attribution });
        tiles.addTo(mymap);
        const marker = L.marker([lat, lon]).addTo(mymap);

        const data = { lat, lon };
        const options = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(data)
        }
        const response = await fetch('/api', options);
        const json = await response.json();
        console.log(json);
      });
    } else {
      console.log('geolocation not available');
    }
  </script>
</body>

</html>